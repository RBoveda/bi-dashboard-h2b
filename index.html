<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BI Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&family=Inter:wght@400;500;600;700&family=Manrope:wght@400;600;700;800&family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:var(--font-body);background:var(--bg);color:var(--text);display:flex;flex-direction:column;height:100vh;overflow:hidden;transition:background .4s,color .4s}

    /* ‚ïê‚ïê TOPBAR ‚ïê‚ïê */
    .topbar{
      height:36px;min-height:36px;
      background:var(--surface);
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;
      padding:0 16px;gap:8px;
      z-index:100;
    }
    .topbar-title{
      font-size:13px;font-weight:600;
      color:var(--text-muted);
      flex:1;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .topbar-title span{color:var(--text);font-weight:700;}
    .topbar-sep{width:1px;height:20px;background:var(--border);margin:0 4px;}
    .topbar-btn{
      display:flex;align-items:center;gap:6px;
      padding:5px 12px;
      border-radius:var(--radius-sm);
      border:1px solid var(--border);
      background:transparent;
      color:var(--text-muted);
      font-size:12px;font-family:var(--font-body);
      cursor:pointer;
      transition:all .15s;
      white-space:nowrap;
    }
    .topbar-btn:hover{background:var(--surface2);color:var(--text);border-color:var(--accent);}
    .topbar-btn.primary{background:var(--accent);color:#fff;border-color:var(--accent);}
    .topbar-btn.primary:hover{opacity:.9;}
    .topbar-btn svg{width:14px;height:14px;flex-shrink:0;}

    /* Dropdown share */
    .dropdown{position:relative;}
    .dropdown-menu{
      display:none;position:absolute;top:calc(100% + 6px);right:0;
      background:var(--surface);border:1px solid var(--border);
      border-radius:var(--radius);min-width:190px;
      box-shadow:0 8px 32px rgba(0,0,0,.25);z-index:999;
      overflow:hidden;
    }
    .dropdown-menu.open{display:block;}
    .dropdown-item{
      display:flex;align-items:center;gap:10px;
      padding:10px 14px;font-size:12px;color:var(--text);
      cursor:pointer;transition:background .12s;
    }
    .dropdown-item:hover{background:var(--surface2);}
    .dropdown-item svg{width:14px;height:14px;color:var(--text-muted);}
    .dropdown-divider{height:1px;background:var(--border);margin:4px 0;}

    /* ‚ïê‚ïê BODY ‚ïê‚ïê */
    .app-body{display:flex;flex:1;overflow:hidden;}

    /* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
    .sidebar{
      width:var(--nav-w);min-width:var(--nav-w);
      background:var(--surface);
      border-right:1px solid var(--border);
      display:flex;flex-direction:column;
      transition:width .3s cubic-bezier(.4,0,.2,1),min-width .3s cubic-bezier(.4,0,.2,1);
      overflow:hidden;position:relative;z-index:10;
    }
    .sidebar.collapsed{width:52px;min-width:52px;}

    .sidebar-header{
      padding:10px 10px;border-bottom:1px solid var(--border);
      display:flex;align-items:center;gap:10px;min-height:36px;
    }
    .logo-wrap{width:28px;height:28px;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
    .logo-wrap img{width:100%;height:100%;object-fit:contain;}
    .logo-fallback{
      width:28px;height:28px;background:var(--accent-gradient);
      border-radius:var(--radius-sm);display:flex;align-items:center;justify-content:center;
      font-size:11px;font-weight:800;color:#fff;font-family:'DM Mono',monospace;
    }
    .logo-text{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;transition:opacity .2s,width .2s;color:var(--text);}
    .sidebar.collapsed .logo-text{opacity:0;width:0;}

    .toggle-btn{
      position:absolute;right:-11px;top:18px;
      width:22px;height:22px;background:var(--surface2);
      border:1px solid var(--border);border-radius:50%;
      cursor:pointer;display:flex;align-items:center;justify-content:center;
      color:var(--text-muted);font-size:9px;
      transition:background .2s,color .2s,transform .3s;z-index:20;
    }
    .toggle-btn:hover{background:var(--accent);color:#fff;}
    .sidebar.collapsed .toggle-btn{transform:rotate(180deg);}

    /* ‚ïê‚ïê NAV TREE ‚ïê‚ïê */
    nav{flex:1;padding:10px 8px;overflow-y:auto;}
    nav::-webkit-scrollbar{width:3px;}
    nav::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

    .nav-section-label{
      font-size:9px;font-family:'DM Mono',monospace;letter-spacing:.12em;
      color:var(--text-muted);text-transform:uppercase;
      padding:10px 8px 5px;white-space:nowrap;transition:opacity .2s;
    }
    .sidebar.collapsed .nav-section-label{opacity:0;}

    /* Category row */
    .nav-category{
      display:flex;align-items:center;gap:10px;
      padding:9px 10px;border-radius:var(--radius);
      cursor:pointer;transition:background .15s;
      position:relative;
    }
    .nav-category:hover{background:var(--surface2);}
    .nav-category.active{background:var(--accent-soft);}
    .nav-category .cat-icon{font-size:15px;flex-shrink:0;width:20px;text-align:center;}
    .nav-category .cat-label{
      font-size:13px;font-weight:600;white-space:nowrap;overflow:hidden;
      flex:1;transition:opacity .2s;
    }
    .sidebar.collapsed .cat-label{opacity:0;}
    .nav-category .cat-badge{
      font-size:9px;font-family:'DM Mono',monospace;
      background:var(--accent);color:#fff;
      padding:2px 6px;border-radius:20px;
      white-space:nowrap;transition:opacity .2s;
    }
    .sidebar.collapsed .cat-badge{opacity:0;}
    .nav-category .cat-arrow{
      font-size:9px;color:var(--text-muted);
      transition:transform .2s,opacity .2s;
      flex-shrink:0;
    }
    .sidebar.collapsed .cat-arrow{opacity:0;}
    .nav-category.open .cat-arrow{transform:rotate(90deg);}

    /* Submenu */
    .nav-submenu{
      overflow:hidden;max-height:0;
      transition:max-height .25s cubic-bezier(.4,0,.2,1);
    }
    .nav-submenu.open{max-height:500px;}
    .sidebar.collapsed .nav-submenu{display:none;}

    .nav-subitem{
      display:flex;align-items:center;gap:8px;
      padding:7px 10px 7px 38px;
      border-radius:var(--radius);
      cursor:pointer;font-size:12px;color:var(--text-muted);
      transition:background .12s,color .12s;
      white-space:nowrap;
    }
    .nav-subitem:hover{background:var(--surface2);color:var(--text);}
    .nav-subitem.active{
      color:var(--accent);font-weight:600;
      background:var(--accent-soft);
    }
    .nav-subitem::before{
      content:'';width:5px;height:5px;border-radius:50%;
      background:var(--border);flex-shrink:0;
      transition:background .12s;
    }
    .nav-subitem.active::before{background:var(--accent);}

    /* Sidebar footer */
    .sidebar-footer{
      padding:12px 10px;border-top:1px solid var(--border);
      display:flex;align-items:center;gap:10px;
    }
    .theme-btn{
      display:flex;align-items:center;gap:8px;padding:7px 10px;
      border-radius:var(--radius);border:1px solid var(--border);
      background:transparent;color:var(--text-muted);
      font-size:11px;font-family:var(--font-body);cursor:pointer;
      transition:all .15s;white-space:nowrap;width:100%;
    }
    .theme-btn:hover{background:var(--surface2);color:var(--text);}
    .sidebar.collapsed .theme-btn span{display:none;}

    /* ‚ïê‚ïê MAIN ‚ïê‚ïê */
    .main{flex:1;display:flex;flex-direction:column;overflow:hidden;background:var(--bg);}

    .page-header{
      padding:16px 24px 12px;border-bottom:1px solid var(--border);
      background:var(--surface);
      display:flex;align-items:center;gap:12px;flex-shrink:0;
    }
    .page-header h1{font-size:18px;font-weight:700;}
    .page-header .breadcrumb{
      font-size:11px;color:var(--text-muted);
      font-family:'DM Mono',monospace;
      display:flex;align-items:center;gap:6px;
      margin-top:2px;
    }
    .page-header .breadcrumb span{color:var(--accent);}

    .content{flex:1;overflow:hidden;position:relative;}
    .panel{
      position:absolute;inset:0;
      display:none;flex-direction:column;
      width:100%;height:100%;
    }
    .panel.active{display:flex;}

    /* KPI row */
    .kpi-row{
      display:flex;gap:12px;padding:16px 20px 12px;flex-shrink:0;
      overflow-x:auto;
    }
    .kpi-card{
      flex:1;min-width:140px;
      background:var(--surface);border:1px solid var(--border);
      border-radius:var(--radius);padding:14px 16px;
      position:relative;overflow:hidden;
      transition:transform .15s,box-shadow .15s;
    }
    .kpi-card:hover{transform:translateY(-1px);box-shadow:0 4px 20px rgba(0,0,0,.15);}
    .kpi-card::before{
      content:'';position:absolute;top:0;left:0;right:0;height:2px;
      background:var(--kpi-color,var(--accent));
    }
    .kpi-label{font-size:10px;font-family:'DM Mono',monospace;letter-spacing:.08em;text-transform:uppercase;color:var(--text-muted);margin-bottom:6px;}
    .kpi-value{font-size:24px;font-weight:800;letter-spacing:-.02em;line-height:1;}
    .kpi-delta{font-size:11px;margin-top:5px;display:flex;align-items:center;gap:4px;}
    .kpi-delta.pos{color:var(--accent2);}
    .kpi-delta.neg{color:#f87171;}

    /* Embed area */
    .embed-area{
      flex:1;margin:0;
      background:var(--bg);
      display:flex;align-items:stretch;justify-content:stretch;
      overflow:hidden;position:relative;
      width:100%;height:100%;
    }
    .embed-area iframe{width:100%;height:100%;border:none;display:block;}
    .embed-placeholder{text-align:center;color:var(--text-muted);}
    .embed-placeholder .icon{font-size:36px;margin-bottom:8px;}
    .embed-placeholder p{font-size:13px;margin-bottom:8px;}
    .embed-placeholder code{
      font-size:11px;font-family:'DM Mono',monospace;
      background:var(--surface2);padding:4px 10px;
      border-radius:var(--radius-sm);color:var(--accent);
    }

    /* Toast */
    .toast{
      position:fixed;bottom:24px;right:24px;
      background:var(--surface);border:1px solid var(--border);
      border-radius:var(--radius);padding:10px 16px;
      font-size:12px;color:var(--text);
      box-shadow:0 4px 20px rgba(0,0,0,.3);
      transform:translateY(80px);opacity:0;
      transition:all .3s cubic-bezier(.4,0,.2,1);
      z-index:9999;
    }
    .toast.show{transform:translateY(0);opacity:1;}
  </style>
</head>
<body>

<!-- ‚ïê‚ïê TOPBAR ‚ïê‚ïê -->
<div class="topbar">
  <div class="topbar-title" id="topbarTitle">
    <span>Ventas</span> ‚Äî KPI
  </div>

  <div class="topbar-sep"></div>

  <!-- Imprimir -->
  <button class="topbar-btn" onclick="window.print()" title="Imprimir">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
    <span>Imprimir</span>
  </button>

  <!-- Exportar dropdown -->
  <div class="dropdown">
    <button class="topbar-btn" onclick="toggleDropdown('exportMenu')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
      <span>Exportar</span>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:10px"><polyline points="6 9 12 15 18 9"/></svg>
    </button>
    <div class="dropdown-menu" id="exportMenu">
      <div class="dropdown-item" onclick="exportAction('pdf')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
        Exportar como PDF
      </div>
      <div class="dropdown-item" onclick="exportAction('ppt')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
        Exportar como PowerPoint
      </div>
      <div class="dropdown-item" onclick="exportAction('excel')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        Exportar datos (Excel)
      </div>
    </div>
  </div>

  <div class="topbar-sep"></div>

  <!-- Compartir dropdown -->
  <div class="dropdown">
    <button class="topbar-btn primary" onclick="toggleDropdown('shareMenu')">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      <span>Compartir</span>
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:10px"><polyline points="6 9 12 15 18 9"/></svg>
    </button>
    <div class="dropdown-menu" id="shareMenu">
      <div class="dropdown-item" onclick="shareAction('link')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
        Copiar enlace
      </div>
      <div class="dropdown-item" onclick="shareAction('email')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Enviar por email
      </div>
      <div class="dropdown-item" onclick="shareAction('teams')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Compartir en Teams
      </div>
      <div class="dropdown-divider"></div>
      <div class="dropdown-item" onclick="shareAction('embed')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
        Obtener c√≥digo embed
      </div>
    </div>
  </div>

  <div class="topbar-sep"></div>

  <!-- Tema -->
  <button class="topbar-btn" id="themeTopBtn" onclick="toggleTheme()" title="Cambiar tema">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
  </button>
</div>

<!-- ‚ïê‚ïê APP BODY ‚ïê‚ïê -->
<div class="app-body">

  <!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê -->
  <aside class="sidebar collapsed" id="sidebar">
    <div class="sidebar-header">
      <div class="logo-wrap" id="logoWrap"></div>
      <div class="logo-text" id="logoText"></div>
    </div>
    <button class="toggle-btn" onclick="toggleSidebar()">‚ñ∂</button>
    <nav id="mainNav"></nav>
    <div class="sidebar-footer">
      <button class="theme-btn" onclick="toggleTheme()">
        üåô <span id="themeLabel">Modo Oscuro</span>
      </button>
    </div>
  </aside>

  <!-- ‚ïê‚ïê MAIN ‚ïê‚ïê -->
  <main class="main">
    <div class="content" id="contentArea"></div>
  </main>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CONFIGURACI√ìN ‚Äî Edita solo este bloque
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BRAND = {
  companyName:  "Analytics Hub",
  logoUrl:      "",
  logoInitials: "BI",
  theme:        "dark",
  accent:       "#4f8ef7",
  accent2:      "#38d9a9",
  accent3:      "#f79c4f",
  accent4:      "#a78bfa",
  fontBody:     "Syne",
  borderStyle:  "soft",

  // ‚îÄ‚îÄ √Årbol de navegaci√≥n ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Cada categor√≠a tiene subcategor√≠as con sus propias URLs de Power BI
  categories: [
    {
      id: "ventas", label: "Ventas", icon: "üìà", badge: "Live",
      items: [
        { id: "ventas-kpi",        label: "KPI",              powerbiUrl: "https://app.powerbi.com/reportEmbed?reportId=31f9f34f-6026-4380-941b-de5927b06cb3&autoAuth=true&ctid=8f1dbd3d-3b9a-4423-a42b-caea805a1d35&pageName=KPI" },
        { id: "ventas-geo",        label: "Geo Ventas",       powerbiUrl: "" },
        { id: "ventas-productos",  label: "Productos",        powerbiUrl: "" },
        { id: "ventas-clientes",   label: "Clientes",         powerbiUrl: "https://app.powerbi.com/reportEmbed?reportId=31f9f34f-6026-4380-941b-de5927b06cb3&autoAuth=true&ctid=8f1dbd3d-3b9a-4423-a42b-caea805a1d35&pageName=Clientes" },
        { id: "ventas-comparativa",label: "Comparativa",      powerbiUrl: "" },
      ]
    },
    {
      id: "compras", label: "Compras", icon: "üõí", badge: "",
      items: [
        { id: "compras-kpi",       label: "KPI",              powerbiUrl: "" },
        { id: "compras-geo",       label: "Geo Compra",       powerbiUrl: "" },
        { id: "compras-productos", label: "Productos",        powerbiUrl: "" },
        { id: "compras-abonos",    label: "Abonos",           powerbiUrl: "" },
        { id: "compras-comparativa",label: "Comparativa",     powerbiUrl: "" },
        { id: "compras-analisis",  label: "An√°lisis Compra",  powerbiUrl: "" },
      ]
    },
    {
      id: "produccion", label: "Producci√≥n", icon: "üè≠", badge: "",
      items: [
        { id: "prod-kpi",          label: "KPI",              powerbiUrl: "" },
        { id: "prod-oee",          label: "OEE",              powerbiUrl: "" },
        { id: "prod-calidad",      label: "Calidad",          powerbiUrl: "" },
        { id: "prod-paradas",      label: "Paradas",          powerbiUrl: "" },
      ]
    },
    {
      id: "financiero", label: "Financiero", icon: "üí∞", badge: "",
      items: [
        { id: "fin-kpi",           label: "KPI",              powerbiUrl: "" },
        { id: "fin-pyl",           label: "P&L",              powerbiUrl: "" },
        { id: "fin-balance",       label: "Balance",          powerbiUrl: "" },
        { id: "fin-tesoreria",     label: "Tesorer√≠a",        powerbiUrl: "" },
        { id: "fin-presupuesto",   label: "Presupuesto",      powerbiUrl: "" },
      ]
    },
  ],

  // ‚îÄ‚îÄ KPIs por dashboard ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  kpis: {
    "ventas-kpi":     [{label:"Ingresos Totales",value:"$4.2M",delta:"‚ñ≤ 12.4%",neg:false,c:""},{label:"√ìrdenes",value:"3,847",delta:"‚ñ≤ 8.1%",neg:false,c:"c2"},{label:"Ticket Promedio",value:"$1,092",delta:"‚ñº 2.3%",neg:true,c:"c3"},{label:"Conversi√≥n",value:"6.8%",delta:"‚ñ≤ 0.5pp",neg:false,c:"c4"}],
    "compras-kpi":    [{label:"Gasto Total",value:"$1.8M",delta:"‚ñº 3.2%",neg:true,c:""},{label:"√ìrdenes Compra",value:"1,203",delta:"‚ñ≤ 5.7%",neg:false,c:"c2"},{label:"Proveedores",value:"84",delta:"‚ñ≤ 2",neg:false,c:"c3"},{label:"Ahorro",value:"$214K",delta:"‚ñ≤ 18%",neg:false,c:"c4"}],
    "prod-kpi":       [{label:"Unidades",value:"28,430",delta:"‚ñ≤ 7.9%",neg:false,c:""},{label:"OEE",value:"82.3%",delta:"‚ñ≤ 1.4pp",neg:false,c:"c2"},{label:"Paradas",value:"4.2h",delta:"‚ñº mejor",neg:false,c:"c3"},{label:"Defectos",value:"0.31%",delta:"‚ñ≤ mejor",neg:false,c:"c4"}],
    "fin-kpi":        [{label:"EBITDA",value:"$890K",delta:"‚ñ≤ 9.1%",neg:false,c:""},{label:"Margen Neto",value:"21.2%",delta:"‚ñ≤ 0.8pp",neg:false,c:"c2"},{label:"Deuda/EBITDA",value:"1.4x",delta:"‚ñº mejor",neg:false,c:"c3"},{label:"Liquidez",value:"2.3",delta:"‚ñ≤ 0.2",neg:false,c:"c4"}],
  },
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ENGINE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const THEMES = {
  dark:  {bg:"#0d0f14",surface:"#13161e",surface2:"#1a1e2a",border:"#252a38",text:"#e8eaf2",textMuted:"#6b7394"},
  light: {bg:"#f4f6fb",surface:"#ffffff",surface2:"#eef1f8",border:"#dde2ef",text:"#1a1e2a",textMuted:"#8892b0"},
};
const RADIUS = {sharp:"0px",soft:"8px",round:"16px"};
const RADIUS_SM = {sharp:"0px",soft:"6px",round:"10px"};

function hexAlpha(hex, a) {
  const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a})`;
}

function applyTheme(name) {
  const t = THEMES[name];
  const root = document.documentElement;
  Object.entries(t).forEach(([k,v]) => root.style.setProperty('--'+k.replace(/([A-Z])/g,'-$1').toLowerCase(), v));
  root.style.setProperty('--accent', BRAND.accent);
  root.style.setProperty('--accent2', BRAND.accent2);
  root.style.setProperty('--accent3', BRAND.accent3);
  root.style.setProperty('--accent4', BRAND.accent4);
  root.style.setProperty('--accent-soft', hexAlpha(BRAND.accent, 0.12));
  root.style.setProperty('--accent-gradient', `linear-gradient(135deg,${BRAND.accent},${BRAND.accent2})`);
  root.style.setProperty('--font-body', `"${BRAND.fontBody}", sans-serif`);
  root.style.setProperty('--nav-w', '220px');
  root.style.setProperty('--radius', RADIUS[BRAND.borderStyle]);
  root.style.setProperty('--radius-sm', RADIUS_SM[BRAND.borderStyle]);
  document.getElementById('themeLabel').textContent = name === 'dark' ? 'Modo Oscuro' : 'Modo Claro';
}

let currentTheme = BRAND.theme;
function toggleTheme() {
  currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
  applyTheme(currentTheme);
}

function toggleSidebar() {
  document.getElementById('sidebar').classList.toggle('collapsed');
}

// ‚îÄ‚îÄ Build nav tree ‚îÄ‚îÄ
let currentItem = null;

function buildNav() {
  const nav = document.getElementById('mainNav');
  const logoWrap = document.getElementById('logoWrap');
  const logoText = document.getElementById('logoText');

  if (BRAND.logoUrl) {
    logoWrap.innerHTML = `<img src="${BRAND.logoUrl}" alt="${BRAND.companyName}"/>`;
  } else {
    logoWrap.innerHTML = `<div class="logo-fallback">${BRAND.logoInitials}</div>`;
  }
  logoText.textContent = BRAND.companyName;
  document.title = BRAND.companyName + ' ‚Äî BI';

  nav.innerHTML = `<div class="nav-section-label">Dashboards</div>`;

  BRAND.categories.forEach((cat, ci) => {
    const catDiv = document.createElement('div');

    const catRow = document.createElement('div');
    catRow.className = 'nav-category' + (ci === 0 ? ' active open' : '');
    catRow.id = 'cat-' + cat.id;
    catRow.innerHTML = `
      <span class="cat-icon">${cat.icon}</span>
      <span class="cat-label">${cat.label}</span>
      ${cat.badge ? `<span class="cat-badge">${cat.badge}</span>` : ''}
      <span class="cat-arrow">‚ñ∂</span>
    `;
    catRow.onclick = () => toggleCategory(cat.id);

    const submenu = document.createElement('div');
    submenu.className = 'nav-submenu' + (ci === 0 ? ' open' : '');
    submenu.id = 'sub-' + cat.id;

    cat.items.forEach((item, ii) => {
      const sub = document.createElement('div');
      sub.className = 'nav-subitem' + (ci === 0 && ii === 0 ? ' active' : '');
      sub.id = 'nav-' + item.id;
      sub.textContent = item.label;
      sub.onclick = () => navigate(cat.id, item.id);
      submenu.appendChild(sub);
    });

    catDiv.appendChild(catRow);
    catDiv.appendChild(submenu);
    nav.appendChild(catDiv);
  });

  // Build content panels
  buildPanels();

  // Set initial active
  const firstCat = BRAND.categories[0];
  const firstItem = firstCat.items[0];
  navigate(firstCat.id, firstItem.id, true);
}

function toggleCategory(catId) {
  const catEl = document.getElementById('cat-' + catId);
  const subEl = document.getElementById('sub-' + catId);
  const isOpen = catEl.classList.contains('open');

  // Close all
  BRAND.categories.forEach(c => {
    document.getElementById('cat-' + c.id).classList.remove('open');
    document.getElementById('sub-' + c.id).classList.remove('open');
  });

  if (!isOpen) {
    catEl.classList.add('open');
    subEl.classList.add('open');
  }
}

function navigate(catId, itemId, silent) {
  const cat = BRAND.categories.find(c => c.id === catId);
  const item = cat.items.find(i => i.id === itemId);

  // Update active states
  document.querySelectorAll('.nav-subitem').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.nav-category').forEach(el => el.classList.remove('active'));
  const navEl = document.getElementById('nav-' + itemId);
  if (navEl) navEl.classList.add('active');
  const catEl = document.getElementById('cat-' + catId);
  if (catEl) catEl.classList.add('active');

  // Open category
  toggleCategory(catId);
  document.getElementById('cat-' + catId).classList.add('open');
  document.getElementById('sub-' + catId).classList.add('open');

  // Update header
  document.getElementById('pageTitle').textContent = cat.label + ' ‚Äî ' + item.label;
  document.getElementById('breadCat').textContent = cat.label;
  document.getElementById('breadSub').textContent = item.label;
  document.getElementById('topbarTitle').innerHTML = `<span>${cat.label}</span> ‚Äî ${item.label}`;

  // Show panel
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  const panel = document.getElementById('panel-' + itemId);
  if (panel) panel.classList.add('active');

  currentItem = {cat, item};
}

function buildPanels() {
  const content = document.getElementById('contentArea');
  content.innerHTML = '';

  BRAND.categories.forEach(cat => {
    cat.items.forEach(item => {
      const panel = document.createElement('div');
      panel.className = 'panel';
      panel.id = 'panel-' + item.id;

      const embed = document.createElement('div');
      embed.className = 'embed-area';

      if (item.powerbiUrl) {
        embed.innerHTML = `<iframe src="${item.powerbiUrl}" allowfullscreen></iframe>`;
      } else {
        embed.innerHTML = `
          <div class="embed-placeholder">
            <div class="icon">üìä</div>
            <p>${cat.label} ‚Äî ${item.label}</p>
            <code>BRAND.categories[].items[].powerbiUrl</code>
          </div>`;
      }
      panel.appendChild(embed);
      content.appendChild(panel);
    });
  });
}

// ‚îÄ‚îÄ Dropdowns ‚îÄ‚îÄ
function toggleDropdown(id) {
  document.querySelectorAll('.dropdown-menu').forEach(m => {
    if (m.id !== id) m.classList.remove('open');
  });
  document.getElementById(id).classList.toggle('open');
}
document.addEventListener('click', e => {
  if (!e.target.closest('.dropdown')) {
    document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.remove('open'));
  }
});

// ‚îÄ‚îÄ Actions ‚îÄ‚îÄ
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

function exportAction(type) {
  toggleDropdown('exportMenu');
  if (type === 'pdf') { window.print(); return; }
  showToast(type === 'ppt' ? 'üìä Abriendo Power BI para exportar a PPT...' : 'üì• Preparando exportaci√≥n de datos...');
}

function shareAction(type) {
  toggleDropdown('shareMenu');
  if (type === 'link') {
    navigator.clipboard.writeText(window.location.href).then(() => showToast('üîó Enlace copiado al portapapeles'));
  } else if (type === 'email') {
    window.location.href = `mailto:?subject=${encodeURIComponent(document.title)}&body=${encodeURIComponent(window.location.href)}`;
  } else if (type === 'teams') {
    window.open(`https://teams.microsoft.com/share?href=${encodeURIComponent(window.location.href)}`,'_blank');
  } else if (type === 'embed') {
    const code = `<iframe src="${window.location.href}" width="100%" height="600" frameborder="0"></iframe>`;
    navigator.clipboard.writeText(code).then(() => showToast('üìã C√≥digo embed copiado'));
  }
}

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
applyTheme(BRAND.theme);
buildNav();
</script>
</body>
</html>
